# Анализ .se Bundle файлов SmartEngines

## Обзор

Данный документ содержит результаты анализа `.se` bundle файлов SmartEngines, используемых SDK для распознавания документов.

## Методология

Анализ выполнен с использованием правильного подхода:
1. **Определение типа файла** - проверка магических байтов, hex dump, strings
2. **Проверка энтропии** - определение зашифрованности/сжатости
3. **Попытки извлечения** - безопасные попытки извлечения содержимого
4. **Анализ использования** - как библиотека загружает и использует bundle

## Результаты анализа

### bundle_international_faces_liveness.se

**Расположение**: `extracted_bundles\assets\bundle_international_faces_liveness.se`

**Размер**: 118,987,071 байт (113.47 MB)

#### 1. Тип файла

**Заголовок (первые 64 байта)**:
```
00000000  73 65 62 75 6E 64 6C 65 31 7E 32 2E 37 2E 32 7E  sebundle1~2.7.2~
00000010  32 36 38 38 66 30 32 36 62 30 66 33 34 64 65 61  2688f026b0f34dea
00000020  33 31 62 33 37 37 62 66 65 35 66 64 31 66 36 65  31b377bfe5fd1f6e
00000030  63 66 32 62 39 38 34 38 31 30 7E A6 D0 1F 95 28  cf2b984810~....(
```

**Определение**:
- **Формат**: Проприетарный формат SmartEngines Bundle
- **Версия**: 2.7.2 (определено из заголовка "sebundle1~2.7.2~")
- **Магические байты**: `sebundle1` - собственный формат, не стандартный архив

**Вывод**: Файл НЕ является ZIP, SQLite, или другим стандартным форматом. Это проприетарный контейнер SmartEngines.

#### 2. Энтропия

**Результаты анализа энтропии (первые 1 MB)**:
- **Энтропия**: 7.9997 bits/byte
- **Максимальная возможная**: 8.0 bits/byte
- **Процент**: 100%
- **Уникальных байтов**: 256 / 256

**Классификация**: **ВЫСОКАЯ ЭНТРОПИЯ**

**Интерпретация**:
- Файл зашифрован, сжат, или содержит случайные данные
- Равномерное распределение байтов (все 256 значений представлены)
- НЕ является текстовым или структурированным форматом
- Практически невозможно извлечь содержимое без знания формата

#### 3. Попытки извлечения

**ZIP**: ❌ Не является ZIP архивом (нет магических байтов `PK`)

**SQLite**: ❌ Не является SQLite базой данных

**Binwalk**: ⚠️ Не протестирован (требует установки)

**Вывод**: Стандартные методы извлечения не применимы. Файл требует проприетарного парсера от SmartEngines.

#### 4. Использование в libjnimultiengine.so

**Как библиотека использует bundle**:

Из декомпилированного кода (`PassportSDK_C/`):

1. **Создание движка**:
   ```c
   se_IdEngine* engine = se_IdEngine_Create("bundle_international_faces_liveness.se");
   ```
   - Путь к bundle передается как строка
   - Библиотека открывает и загружает bundle при создании движка

2. **Активация**:
   ```c
   se_IdEngine_Activate(engine, NULL);  // Лицензия в бандле
   ```
   - Лицензия встроена в bundle файл
   - Активация происходит без внешнего ключа

3. **JNI интерфейс**:
   ```c
   Java_com_smartengines_id_jniidengineJNI_IdEngine_1Create(
       JNIEnv* env, jclass cls, jstring bundle_path
   )
   ```
   - Android приложение передает путь к bundle через JNI
   - Bundle обычно находится в `assets/` папке APK

**Вывод**: Библиотека имеет встроенный парсер для формата `.se`. Bundle содержит:
- ML-модели для распознавания
- Лицензионную информацию
- Конфигурацию движка

## Другие .se файлы

В проекте найдены следующие bundle файлы:

1. `bundle_international_faces_liveness.se` (113.47 MB) - основной bundle для распознавания
2. `bundle_codeengine_full.se` - движок кодов
3. `bundle_newdocengine_demo_hiring_dsn.se` - движок новых документов
4. `bundle_textengine.se` - текстовый движок

**Рекомендация**: Выполнить аналогичный анализ для остальных bundle файлов.

## Выводы и рекомендации

### 1. Тип файла

✅ **Определено**: Проприетарный формат SmartEngines Bundle версии 2.7.2

### 2. Возможность извлечения

❌ **Невозможно** стандартными методами:
- Не является ZIP/SQLite/стандартным архивом
- Высокая энтропия указывает на шифрование/сжатие
- Требуется проприетарный парсер от SmartEngines

### 3. Практический подход

**Что можно сделать**:

1. **Анализ загрузчика в .so**:
   - Использовать Ghidra для анализа функций загрузки bundle
   - Найти алгоритм парсинга формата `.se`
   - Понять структуру bundle через reverse engineering

2. **Динамический анализ**:
   - Использовать Frida для перехвата вызовов загрузки bundle
   - Проследить, как библиотека читает и парсит bundle
   - Захватить распакованные данные в памяти

3. **Оставить как есть**:
   - Bundle файлы - это данные (ML-модели), не код
   - Для работы SDK они нужны в оригинальном виде
   - Модификация может сломать функциональность

### 4. Рекомендации

**Для модификации SDK**:
- ✅ Можно модифицировать `.so` библиотеку (после декомпиляции)
- ✅ Можно модифицировать Java/Kotlin код приложения
- ❌ НЕ рекомендуется модифицировать `.se` bundle файлы
- ⚠️ Bundle может иметь проверку целостности/подписи

**Для понимания работы**:
- Изучить декомпилированный код в `PassportSDK_C/`
- Проанализировать JNI мост в `PassportSDK_C/jni/se_jni_bridge.c`
- Использовать Ghidra для анализа функций загрузки bundle

## Инструменты

Созданные скрипты для анализа:

1. **analyze_se_file.ps1** - определение типа файла
   ```powershell
   powershell -ExecutionPolicy Bypass -File analyze_se_file.ps1 -FilePath "path\to\bundle.se"
   ```

2. **check_entropy.ps1** - проверка энтропии
   ```powershell
   powershell -ExecutionPolicy Bypass -File check_entropy.ps1 -FilePath "path\to\bundle.se"
   ```

3. **extract_se_bundle.ps1** - попытки извлечения
   ```powershell
   powershell -ExecutionPolicy Bypass -File extract_se_bundle.ps1 -FilePath "path\to\bundle.se"
   ```

4. **check_se_references.ps1** - поиск ссылок в .so
   ```powershell
   powershell -ExecutionPolicy Bypass -File check_se_references.ps1
   ```

## Следующие шаги

1. ✅ Определить тип файла - **выполнено**
2. ✅ Проверить энтропию - **выполнено**
3. ⏳ Проанализировать загрузчик bundle в Ghidra (опционально)
4. ⏳ Попробовать динамический анализ с Frida (опционально)
5. ✅ Документировать результаты - **выполнено**

## Заключение

`.se` bundle файлы SmartEngines являются **проприетарными зашифрованными контейнерами**, содержащими ML-модели и лицензионную информацию. Они **не подлежат декомпиляции** в исходный код, так как это данные, а не исполняемый код.

**Правильный подход**: Фокус на анализе и модификации `.so` библиотеки и Java/Kotlin кода приложения, а не на попытках извлечения/модификации bundle файлов.
